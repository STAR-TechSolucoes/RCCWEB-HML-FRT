<main class="content-fluid">
  <div class="card shadow-sm">
    <div class="card-body">
      <h2 class="card-title mb-4">{{ modoEdicao ? 'Editar Evento' : 'Cadastro de Eventos' }}</h2>
      
      <form #eventoForm="ngForm" (ngSubmit)="cadastrar(eventoForm)" novalidate>
        
        <div class="row">
          <div class="col-md-4 mb-3">
            <app-campo-texto label="Nome do Evento" name="evtNome" 
              [value]="evento.evtNome" (valueChange)="evento.evtNome = $event" [required]="true">
            </app-campo-texto>
          </div>
          <div class="col-md-6 mb-3">
            <app-campo-texto label="Descrição do Evento" name="evtDescricao" 
              [value]="evento.evtDescricao" (valueChange)="evento.evtDescricao = $event" [required]="true">
            </app-campo-texto>
          </div>
          <div class="col-md-2 mb-3">
            <app-campo-texto label="Qtd Máx." name="evtQtdMaxInscritos" [apenasNumeros]="true"
              [value]="evento.evtQtdMaxInscritos" (valueChange)="evento.evtQtdMaxInscritos = $event" [required]="true">
            </app-campo-texto>
          </div>
        </div>

        <div class="row">
          <div class="col-md-3 mb-3">
            <label class="form-label">Data/Hora Início <span class="text-danger">*</span></label>
            <input type="datetime-local" class="form-control" name="evtDataHoraInicio" 
              [(ngModel)]="evento.evtDataHoraInicio" required>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">Data/Hora Fim</label>
            <input type="datetime-local" class="form-control" name="evtDataHoraFim" 
              [(ngModel)]="evento.evtDataHoraFim">
          </div>
          <div class="col-md-6 mb-3">
            <app-campo-texto label="Observações" name="evtObs" 
              [value]="evento.evtObs" (valueChange)="evento.evtObs = $event">
            </app-campo-texto>
          </div>
        </div>

        <hr class="my-4">

        <div class="row">
          <div class="col-md-4 mb-3">
            <app-campo-cep name="evtCep" [value]="evento.evtCep" (valueChange)="evento.evtCep = $event" 
              [required]="true" (cidadeEncontrada)="atualizarCidade($event)">
            </app-campo-cep>
          </div>
          <div class="col-md-6 mb-3">
            <app-campo-cidade name="evtCidade" [value]="evento.evtCidade" (valueChange)="evento.evtCidade = $event"
              [cidades]="cidades" [required]="true">
            </app-campo-cidade>
          </div>
          <div class="col-md-2 mb-3">
            <app-campo-texto name="evtNumero" label="Número" [value]="evento.evtNumero" 
              (valueChange)="evento.evtNumero = $event" [required]="true">
            </app-campo-texto>
          </div>
          <div class="col-md-6 mb-3">
            <app-campo-texto name="evtLogradouro" label="Logradouro" [value]="evento.evtLogradouro" 
              (valueChange)="evento.evtLogradouro = $event" [required]="true">
            </app-campo-texto>
          </div>
          <div class="col-md-6 mb-3">
            <app-campo-texto name="evtBairro" label="Bairro" [value]="evento.evtBairro" 
              (valueChange)="evento.evtBairro = $event" [required]="true">
            </app-campo-texto>
          </div>
        </div>

        <hr class="my-4">

        <div class="row">
          <div class="col-md-12 mb-3">
            <app-campo-imagem 
              label="Banner/Imagem do Evento" 
              [value]="evento.evtImagem" 
              (imagemChange)="evento.evtImagem = $event">
            </app-campo-imagem>
          </div>
        </div>
        <div class="d-flex justify-content-end mt-4">
          <button type="submit" class="btn btn-primary btn-lg" [disabled]="eventoForm.invalid">
            <i class="bi bi-check-circle-fill me-2"></i>
            {{ modoEdicao ? 'Salvar Alterações' : 'Cadastrar Evento' }}
          </button>
        </div>
      </form>
      <div class="card mt-4">
        <div class="card-header">Configurar Formulário de Inscrição</div>
        <div class="card-body">
          <div *ngFor="let campo of camposCustomizados; let i = index" class="row mb-3 border-bottom pb-2">
            <div class="col-md-4">
              <input type="text" [(ngModel)]="campo.label" class="form-control" placeholder="Pergunta (ex: Tamanho da Camisa)">
            </div>
            <div class="col-md-3">
              <select [(ngModel)]="campo.tipo" class="form-select">
                <option value="text">Texto Curto</option>
                <option value="number">Número</option>
                <option value="select">Seleção (Múltipla Escolha)</option>
              </select>
            </div>
            <div class="col-md-2">
              <div class="form-check pt-2">
                <input type="checkbox" [(ngModel)]="campo.obrigatorio" class="form-check-input">
                <label class="form-check-label">Obrigatório</label>
              </div>
            </div>
            <div class="col-md-1">
              <button (click)="removerCampo(i)" class="btn btn-danger btn-sm">X</button>
            </div>
            
            <!-- Se for select, mostra campo para opções -->
            <div class="col-12 mt-2" *ngIf="campo.tipo === 'select'">
              <input type="text" class="form-control form-control-sm" placeholder="Opções separadas por vírgula (ex: P, M, G, GG)" 
                      (blur)="campo.opcoes = $any($event.target).value.split(',')">
            </div>
          </div>
          <button (click)="adicionarCampo()" class="btn btn-outline-primary btn-sm">+ Adicionar Pergunta</button>
        </div>
      </div>
    </div>
  </div>
</main>